plugins {
    id "de.undercouch.download" version "4.1.1"
}

apply plugin: 'java'

group 'com.iyxan23.jar.example'
version '1.0'

repositories {
    mavenCentral()
}

task buildDexJar(dependsOn:jar) {
    doLast {
        if (!new File(buildDir, "d8.jar").exists()) {
            println "Downloading d8... (one time only)"

            download {
                src 'https://download1587.mediafire.com/v03pxj2159hg/n3pnyus4cxqjsaq/d8.jar'
                dest buildDir
            }
        }

        javaexec {
            group = "Execution"
            description = "Run d8 to dexify the generated JAR file so it can be run on an android device"
            classpath = files(new File(buildDir, "d8.jar"))
            main = "com.android.tools.r8.D8"
            args = ['--output', 'output.jar', '--min-api', '21', jar.archiveFile.get().asFile.path]
        }
    }
}

dependencies {
    implementation 'de.undercouch:gradle-download-task:4.1.1'

    testImplementation 'org.junit.jupiter:junit-jupiter-api:5.6.0'
    testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine'
}

test {
    useJUnitPlatform()
}